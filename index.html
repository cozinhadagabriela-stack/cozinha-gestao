<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cozinha da Gabriela - Gestão</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- CSS separado -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Firebase SDKs (CDN) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <!-- Configuração do Firebase (inicializa app, auth e db) -->
  <script src="firebase-config.js"></script>

  <!-- Lógica da aplicação -->
  <script src="app.js" defer></script>
</head>
<body>
  <header>
    <h1>Cozinha da Gabriela - Gestão</h1>
    <div id="user-info">
      <span id="user-email"></span>
      <button id="btn-logout">Sair</button>
    </div>
  </header>

  <main>
    <!-- LOGIN -->
    <div id="login-card" class="card">
      <h2>Entrar</h2>
      <p class="placeholder">
        Faça login com o e-mail e senha cadastrados no Firebase para acessar o painel.
      </p>

      <div class="form-group">
        <label for="login-email">E-mail</label>
        <input type="email" id="login-email" placeholder="seuemail@exemplo.com">
      </div>

      <div class="form-group">
        <label for="login-password">Senha</label>
        <input type="password" id="login-password" placeholder="Sua senha">
      </div>

      <button id="btn-login" class="primary">Entrar</button>
      <div id="login-error"></div>
      <div id="loading" class="hidden">Entrando...</div>
    </div>

    <!-- APLICAÇÃO -->
    <div id="app-card" class="card hidden">
      <div class="nav-tabs">
        <button id="tab-venda" class="active-tab">Registrar venda</button>
        <button id="tab-extrato">Extrato de vendas / KPI</button>
        <button id="tab-clientes">Cadastrar clientes</button>
        <button id="tab-produtos">Cadastrar produtos</button>
        <button id="tab-formas">Formas de pagamento</button>
      </div>

      <!-- REGISTRAR VENDA -->
      <div id="section-venda" class="subsection">
        <h2>Registrar venda</h2>
        <p class="placeholder">
          Cliente, produto e forma de pagamento vêm das listas cadastradas aqui no sistema.
          O valor total é calculado: quantidade × valor unitário.
        </p>

        <div class="form-group">
          <label for="sale-date">Data da venda</label>
          <input type="date" id="sale-date">
        </div>

        <div class="form-group">
          <label for="sale-lote">Lote</label>
          <input type="text" id="sale-lote" placeholder="Ex.: 2025-001">
        </div>

        <div class="form-group">
          <label for="sale-nf-number">Nº Nota Fiscal</label>
          <input type="text" id="sale-nf-number" placeholder="Ex.: 12345">
        </div>

        <div class="form-group">
          <label for="sale-nf-series">Série Nota Fiscal</label>
          <input type="text" id="sale-nf-series" placeholder="Ex.: 1">
        </div>

        <div class="form-group">
          <label for="sale-client">Cliente</label>
          <select id="sale-client">
            <option value="">Selecione um cliente</option>
          </select>
        </div>

        <div class="form-group">
          <label for="sale-product">Produto</label>
          <select id="sale-product">
            <option value="">Selecione um produto</option>
          </select>
        </div>

        <div class="form-group">
          <label for="sale-quantity">Quantidade (unidades/bandejas)</label>
          <input type="number" id="sale-quantity" min="1" step="1" value="1">
        </div>

        <div class="form-group">
          <label for="sale-unit-price">Valor unitário (R$)</label>
          <input type="number" id="sale-unit-price" min="0" step="0.01" placeholder="Ex.: 10.00">
        </div>

        <div class="form-group">
          <label for="sale-total">Valor total (R$)</label>
          <input type="number" id="sale-total" min="0" step="0.01" readonly>
        </div>

        <div class="form-group">
          <label for="sale-payment">Forma de pagamento</label>
          <select id="sale-payment">
            <option value="">Selecione a forma de pagamento</option>
          </select>
        </div>

        <button id="btn-save-sale" class="primary">Salvar venda</button>
        <div id="sale-message" class="msg"></div>
      </div>

      <!-- EXTRATO DE VENDAS / KPI -->
      <div id="section-extrato" class="subsection hidden">
        <h2>Extrato de vendas / KPI</h2>
        <p class="placeholder">
          Aqui você acompanha o extrato das últimas vendas, aplica filtros por período, cliente, produto e forma de
          pagamento, e vê os principais indicadores (KPIs) do período filtrado.
        </p>

        <h3>Últimas vendas (mais recentes)</h3>
        <p class="placeholder">
          Abaixo estão as últimas vendas lançadas. Você pode filtrar por período, cliente, produto e forma de pagamento,
          ver os indicadores do período e excluir lançamentos com erro.
        </p>

        <!-- FILTROS -->
        <div class="filtros-venda">
          <div class="filtros-grid">
            <div class="form-group">
              <label for="filter-start">Data inicial</label>
              <input type="date" id="filter-start">
            </div>
            <div class="form-group">
              <label for="filter-end">Data final</label>
              <input type="date" id="filter-end">
            </div>
            <div class="form-group">
              <label for="filter-client">Cliente</label>
              <select id="filter-client">
                <option value="">Todos os clientes</option>
              </select>
            </div>
            <div class="form-group">
              <label for="filter-product">Produto</label>
              <select id="filter-product">
                <option value="">Todos os produtos</option>
              </select>
            </div>
            <div class="form-group">
              <label for="filter-forma">Forma de pagamento</label>
              <select id="filter-forma">
                <option value="">Todas as formas</option>
              </select>
            </div>
          </div>
          <div class="filtros-botoes">
            <button id="btn-apply-filters" class="btn-secundario">Aplicar filtros</button>
            <button id="btn-clear-filters" class="btn-secundario">Limpar filtros</button>
            <button id="btn-export-csv" class="btn-secundario">
              Exportar CSV (vendas filtradas)
            </button>
          </div>
        </div>

        <!-- INDICADORES (KPIs) -->
        <div class="kpi-container">
          <h4>Indicadores do período filtrado (base nas últimas 100 vendas)</h4>
          <div class="kpi-grid">
            <div class="kpi-card">
              <span class="kpi-label">Total vendido (R$)</span>
              <span class="kpi-value" id="kpi-total-vendas">R$ 0,00</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-label">Qtd total vendida (unidades)</span>
              <span class="kpi-value" id="kpi-qtd-vendida">0</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-label">Número de vendas</span>
              <span class="kpi-value" id="kpi-num-vendas">0</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-label">Cliente que mais comprou</span>
              <span class="kpi-value" id="kpi-top-cliente">—</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-label">Produto mais vendido</span>
              <span class="kpi-value" id="kpi-top-produto">—</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-label">Cidade que mais comprou</span>
              <span class="kpi-value" id="kpi-top-cidade">—</span>
            </div>
          </div>

          <!-- Tabelas de detalhamento -->
          <div class="kpi-extra">
            <h4>Detalhamento resumido (apenas vendas filtradas)</h4>
            <div class="kpi-extra-grid">
              <div class="kpi-extra-block">
                <strong>Produtos</strong>
                <table class="kpi-table">
                  <thead>
                    <tr>
                      <th>Produto</th>
                      <th>Qtd</th>
                      <th>Total (R$)</th>
                    </tr>
                  </thead>
                  <tbody id="kpi-produtos-body">
                    <tr><td colspan="3">Sem dados.</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="kpi-extra-block">
                <strong>Formas de pagamento</strong>
                <table class="kpi-table">
                  <thead>
                    <tr>
                      <th>Forma</th>
                      <th>Total (R$)</th>
                      <th>%</th>
                    </tr>
                  </thead>
                  <tbody id="kpi-formas-body">
                    <tr><td colspan="3">Sem dados.</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="kpi-extra-block">
                <strong>Cidades</strong>
                <table class="kpi-table">
                  <thead>
                    <tr>
                      <th>Cidade</th>
                      <th>Total (R$)</th>
                    </tr>
                  </thead>
                  <tbody id="kpi-cidades-body">
                    <tr><td colspan="2">Sem dados.</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <table>
          <thead>
            <tr>
              <th>Data</th>
              <th>Cliente</th>
              <th>Produto</th>
              <th>Qtd</th>
              <th>Vlr unit. (R$)</th>
              <th>Vlr total (R$)</th>
              <th>Lote</th>
              <th>Nº NF</th>
              <th>Série</th>
              <th>Forma</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="sales-tbody">
            <tr><td colspan="11">Nenhuma venda carregada.</td></tr>
          </tbody>
        </table>
        <p id="sales-total" class="resumo-total"></p>
      </div>

      <!-- CADASTRAR CLIENTES -->
      <div id="section-clientes" class="subsection hidden">
        <h2>Cadastrar cliente</h2>
        <p class="placeholder">
          Clientes cadastrados aqui aparecem na lista da tela de vendas.
        </p>

        <div class="form-group">
          <label for="cli-nome">Nome do cliente</label>
          <input type="text" id="cli-nome" placeholder="Ex.: Mercado Avenida">
        </div>

        <div class="form-group">
          <label for="cli-cidade">Cidade</label>
          <input type="text" id="cli-cidade" placeholder="Ex.: Arenápolis - MT">
        </div>

        <button id="btn-save-cliente" class="primary">Salvar cliente</button>
        <button id="btn-cancel-cliente" class="btn-small hidden">Cancelar edição</button>
        <div id="cli-message" class="msg"></div>

        <hr>
        <h3>Clientes cadastrados</h3>
        <table class="kpi-table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Cidade</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="clientes-tbody">
            <tr><td colspan="3">Nenhum cliente cadastrado.</td></tr>
          </tbody>
        </table>
      </div>

      <!-- CADASTRAR PRODUTOS -->
      <div id="section-produtos" class="subsection hidden">
        <h2>Cadastrar produto</h2>
        <p class="placeholder">
          Produtos cadastrados aqui aparecem na lista da tela de vendas e trazem o valor unitário.
        </p>

        <div class="form-group">
          <label for="prod-desc">Descrição do produto</label>
          <input type="text" id="prod-desc" placeholder="Ex.: Biscoito de Coco 200g">
        </div>

        <div class="form-group">
          <label for="prod-peso">Peso (g)</label>
          <input type="number" id="prod-peso" min="0" step="1" placeholder="Ex.: 200">
        </div>

        <div class="form-group">
          <label for="prod-preco">Valor unitário (R$)</label>
          <input type="number" id="prod-preco" min="0" step="0.01" placeholder="Ex.: 10.00">
        </div>

        <button id="btn-save-produto" class="primary">Salvar produto</button>
        <button id="btn-cancel-produto" class="btn-small hidden">Cancelar edição</button>
        <div id="prod-message" class="msg"></div>

        <hr>
        <h3>Produtos cadastrados</h3>
        <table class="kpi-table">
          <thead>
            <tr>
              <th>Descrição</th>
              <th>Peso (g)</th>
              <th>Valor unit. (R$)</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="produtos-tbody">
            <tr><td colspan="4">Nenhum produto cadastrado.</td></tr>
          </tbody>
        </table>
      </div>

      <!-- CADASTRAR FORMAS DE PAGAMENTO -->
      <div id="section-formas" class="subsection hidden">
        <h2>Formas de pagamento</h2>
        <p class="placeholder">
          As formas cadastradas aqui aparecem na lista da tela de vendas.
        </p>

        <div class="form-group">
          <label for="fp-desc">Descrição da forma de pagamento</label>
          <input type="text" id="fp-desc" placeholder="Ex.: Pix, Dinheiro, Cartão crédito">
        </div>

        <button id="btn-save-forma" class="primary">Salvar forma de pagamento</button>
        <button id="btn-cancel-forma" class="btn-small hidden">Cancelar edição</button>
        <div id="fp-message" class="msg"></div>

        <hr>
        <h3>Formas de pagamento cadastradas</h3>
        <table class="kpi-table">
          <thead>
            <tr>
              <th>Descrição</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="formas-tbody">
            <tr><td colspan="2">Nenhuma forma cadastrada.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>
</body>
</html>
