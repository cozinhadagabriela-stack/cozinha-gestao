<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cozinha da Gabriela - Gestão</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- CSS separado -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Firebase SDKs (CDN) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <!-- Configuração do Firebase -->
  <script src="firebase-config.js"></script>

  <!-- Chart.js para os gráficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- jsPDF (Relatório em PDF) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

  <!-- Módulos da aplicação -->
  <script src="js/state.js" defer></script>
  <script src="js/ui.js" defer></script>
  <script src="js/cadastros.js" defer></script>
  <script src="js/estoque.js" defer></script>
  <script src="js/estoque-insumos.js" defer></script>
  <script src="js/vendas.js" defer></script>
  <script src="js/despesas.js" defer></script>
  <script src="js/relatorio.js" defer></script>
  <script src="js/caixa.js" defer></script>
  <script src="js/auth.js" defer></script>
</head>
<body>
  <header>
    <h1>Cozinha da Gabriela - Gestão</h1>
    <div id="user-info">
      <span id="user-email"></span>
      <button id="btn-logout">Sair</button>
    </div>
  </header>

  <main>
    <!-- LOGIN -->
    <div id="login-card" class="card login-card">
      <h2>Login</h2>

      <div class="form-group">
        <label for="login-email">E-mail</label>
        <input type="email" id="login-email" placeholder="seuemail@exemplo.com" />
      </div>

      <div class="form-group">
        <label for="login-password">Senha</label>
        <input type="password" id="login-password" placeholder="Sua senha" />
      </div>

      <div class="login-actions">
        <button id="btn-login" class="btn-primario">Entrar</button>

        <button id="btn-forgot-password" class="btn-link" type="button">
          Esqueceu a senha?
        </button>
      </div>

      <span id="loading" class="loading hidden">Carregando...</span>

      <p id="login-error" class="msg error"></p>
      <p id="forgot-message" class="msg"></p>
    </div>

    <!-- APP -->
    <div id="app-card" class="card hidden">
      <!-- Abas -->
      <div class="tabs">
        <button id="tab-venda" class="tab active-tab">Lançamento de vendas</button>
        <button id="tab-lancamento-despesas" class="tab">Lançamento de despesas</button>
        <button id="tab-extrato" class="tab">Extrato / Relatório</button>
        <button id="tab-estoque" class="tab">Estoque</button>
        <button id="tab-cadastros" class="tab">Cadastros</button>
        <button id="tab-caixa" class="tab">Financeiro</button>
      </div>

      <!-- Venda -->
      <div id="section-venda" class="section">
        <h2>Registrar venda</h2>

        <div class="form-grid">
          <div class="form-group">
            <label for="sale-date">Data da venda</label>
            <input type="date" id="sale-date">
          </div>

          <div class="form-group">
            <label for="sale-client">Cliente</label>
            <select id="sale-client">
              <option value="">Selecione um cliente</option>
            </select>
          </div>

          <div class="form-group">
            <label for="sale-payment">Forma de pagamento</label>
            <select id="sale-payment">
              <option value="">Selecione a forma de pagamento</option>
            </select>
          </div>

          <div class="form-group">
            <label for="sale-nf-number">Nº Nota Fiscal</label>
            <input type="text" id="sale-nf-number" placeholder="Ex.: 12345">
          </div>
        </div>

        <h3>Itens do pedido</h3>

        <div class="form-grid">
          <div class="form-group">
            <label for="sale-product">Produto</label>
            <select id="sale-product">
              <option value="">Selecione um produto</option>
            </select>
          </div>

          <div class="form-group">
            <label for="sale-lote">Lote</label>
            <input type="text" id="sale-lote" placeholder="Ex.: 2025-001" maxlength="8">
          </div>

          <div class="form-group">
            <label for="sale-quantity">Quantidade</label>
            <input type="number" id="sale-quantity" min="1" value="1">
          </div>

          <div class="form-group">
            <label for="sale-unit-price">Valor unitário (R$)</label>
            <input type="number" step="0.01" id="sale-unit-price" placeholder="0,00">
          </div>
        </div>

        <button id="btn-add-item" class="btn-primario">Adicionar item</button>

        <div class="table-wrapper">
          <table id="estoque-insumos-saldos-table">
            <thead>
              <tr>
                <th>Produto</th>
                <th>Lote</th>
                <th>Quantidade</th>
                <th>Valor unitário (R$)</th>
                <th>Total (R$)</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="pedido-itens-tbody">
              <tr><td colspan="6">Nenhum item adicionado.</td></tr>
            </tbody>
          </table>
        </div>

        <div class="form-group">
          <label for="sale-total">Total do pedido (R$)</label>
          <input type="number" step="0.01" id="sale-total" placeholder="0,00" readonly>
        </div>

        <button id="btn-save-sale" class="btn-primario">Salvar venda</button>
        <p id="sale-message" class="msg"></p>
      </div>

      
      <!-- Lançamento de despesas -->
      <div id="section-lancamento-despesas" class="section hidden">
        <h2>Lançamento de despesas</h2>

        <div class="form-grid">
          <div class="form-group">
            <label for="desp-fornecedor">Fornecedor</label>
            <select id="desp-fornecedor">
              <option value="">Selecione um fornecedor</option>
            </select>
          </div>

          <div class="form-group">
            <label for="desp-data">Data de pagamento</label>
            <input type="date" id="desp-data" />
          </div>

          <div class="form-group">
            <label for="desp-data-entrada">Data de entrada no estoque</label>
            <input type="date" id="desp-data-entrada" />
          </div>

          <div class="form-group">
            <label for="desp-forma-pagamento">Forma de pagamento</label>
            <select id="desp-forma-pagamento">
              <option value="">Selecione a forma de pagamento</option>
            </select>
          </div>
        </div>

        <h3>Itens da despesa</h3>

        <div class="form-grid">
          <div class="form-group">
            <label for="desp-item">Item do fornecedor</label>
            <select id="desp-item">
              <option value="">Selecione um item (opcional)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="desp-quantidade">Quantidade</label>
            <input type="number" id="desp-quantidade" min="1" value="1" />
          </div>

          <div class="form-group">
            <label for="desp-valor-unitario">Valor unitário (R$)</label>
            <input type="number" step="0.01" id="desp-valor-unitario" placeholder="0,00" />
          </div>

          <div class="form-group">
            <label for="desp-descricao">Descrição do item</label>
            <input type="text" id="desp-descricao" placeholder="Descrição do item (pode vir do cadastro)" />
          </div>

          <div class="form-group">
            <label for="desp-marca">Marca</label>
            <input type="text" id="desp-marca" placeholder="Ex.: Sadia, Aurora, Marca própria... (opcional)" />
          </div>

          <div class="form-group">
            <label for="desp-valor-total">Valor total (R$)</label>
            <input type="number" step="0.01" id="desp-valor-total" placeholder="0,00" readonly />
          </div>
        </div>

        <button id="btn-desp-add-item" class="btn-primario">Adicionar item</button>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Item</th>
                <th>Quantidade</th>
                <th>Valor unitário (R$)</th>
                <th>Total (R$)</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="desp-pedido-itens-tbody">
              <tr><td colspan="5">Nenhum item adicionado.</td></tr>
            </tbody>
          </table>
        </div>

        <div class="form-group">
          <label for="desp-lanc-total">Total do lançamento (R$)</label>
          <input type="number" step="0.01" id="desp-lanc-total" placeholder="0,00" readonly />
        </div>

        <button id="btn-save-despesa" class="btn-primario">Salvar despesas</button>
        <p id="desp-message" class="msg"></p>
      </div>


      <!-- Extrato / Relatório -->
      <div id="section-extrato" class="section hidden">
        <h2>Extrato / Relatório</h2>

        <div class="tabs subtabs">
          <button id="subtab-extrato-vendas" class="tab active-tab">Vendas</button>
          <button id="subtab-extrato-despesas" class="tab">Despesas</button>
          <button id="subtab-extrato-relatorio" class="tab">Relatório</button>
        </div>

        <div id="extrato-vendas-wrap">
        <h3>Extrato de vendas</h3>

                <!-- FILTROS -->
                <div class="filtros-container">
                  <div class="filtros-grid">
                    <div class="form-group">
                      <label for="filter-start">Data inicial</label>
                      <input type="date" id="filter-start">
                    </div>
                    <div class="form-group">
                      <label for="filter-end">Data final</label>
                      <input type="date" id="filter-end">
                    </div>
                    <div class="form-group">
                      <label for="filter-client">Cliente</label>
                      <select id="filter-client">
                        <option value="">Todos os clientes</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="filter-product">Produto</label>
                      <select id="filter-product">
                        <option value="">Todos os produtos</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="filter-forma">Forma de pagamento</label>
                      <select id="filter-forma">
                        <option value="">Todas as formas</option>
                      </select>
                    </div>
                    <!-- NOVO: filtro de Nota Fiscal -->
                    <div class="form-group">
                      <label for="filter-nf">Nota fiscal</label>
                      <select id="filter-nf">
                        <option value="">Todas</option>
                        <option value="com">Somente com NF</option>
                        <option value="sem">Somente sem NF</option>
                      </select>
                    </div>
                  </div>
                  <div class="filtros-botoes">
                    <button id="btn-apply-filters" class="btn-secundario">Aplicar filtros</button>
                    <button id="btn-clear-filters" class="btn-secundario">Limpar filtros</button>
                    <button id="btn-export-csv" class="btn-secundario">
                      Exportar CSV (vendas filtradas)
                    </button>
                  </div>
                </div>

                <!-- KPIs -->
                <div class="kpi-container">
                  <h4>Indicadores do período filtrado </h4>
                  <div class="kpi-grid">
                    <div class="kpi-card">
                      <span class="kpi-label">Total vendido (R$)</span>
                      <span class="kpi-value" id="kpi-total-vendas">R$ 0,00</span>
                    </div>
                    <div class="kpi-card">
                      <span class="kpi-label">Quantidade vendida (unid.)</span>
                      <span class="kpi-value" id="kpi-qtd-vendida">0</span>
                    </div>
                    <div class="kpi-card">
                      <span class="kpi-label">Número de vendas</span>
                      <span class="kpi-value" id="kpi-num-vendas">0</span>
                    </div>
                    <div class="kpi-card">
                      <span class="kpi-label">Cliente com maior valor em compras</span>
                      <span class="kpi-value" id="kpi-top-cliente">—</span>
                    </div>
                    <div class="kpi-card">
                      <span class="kpi-label">Produto mais vendido (por quantidade)</span>
                      <span class="kpi-value" id="kpi-top-produto">—</span>
                    </div>
                    <div class="kpi-card">
                      <span class="kpi-label">Cidade com maior faturamento</span>
                      <span class="kpi-value" id="kpi-top-cidade">—</span>
                    </div>
                  </div>
                </div>


                <!-- COMPARAÇÃO (mesmas datas do mês anterior) -->
                <h4>Comparação vs mesmas datas do mês anterior</h4>
                <div class="kpi-grid">
                  <div class="kpi-card">
                    <span class="kpi-label">Faturamento vs anterior</span>
                    <span class="kpi-value" id="kpi-comp-faturamento">—</span>
                  </div>
                  <div class="kpi-card">
                    <span class="kpi-label">Unidades vs anterior</span>
                    <span class="kpi-value" id="kpi-comp-unidades">—</span>
                  </div>
                  <div class="kpi-card">
                    <span class="kpi-label">Ticket médio vs anterior</span>
                    <span class="kpi-value" id="kpi-comp-ticket-medio">—</span>
                  </div>
                  <div class="kpi-card">
                    <span class="kpi-label">Preço médio (R$/un.) vs anterior</span>
                    <span class="kpi-value" id="kpi-comp-preco-medio">—</span>
                  </div>
                  <div class="kpi-card">
                    <span class="kpi-label">Clientes únicos vs anterior</span>
                    <span class="kpi-value" id="kpi-comp-clientes-unicos">—</span>
                  </div>
                </div>

                <!-- GRÁFICOS (menores) -->
                <div class="charts-grid">
                  <div class="chart-card">
                    <h4>Evolução do faturamento mensal</h4>
                    <div class="chart-wrapper">
                      <canvas id="chart-faturamento-mensal"></canvas>
                    </div>
                  </div>

                  <div class="chart-card">
                    <h4>Distribuição de vendas por produto</h4>
                    <div class="chart-wrapper">
                      <canvas id="chart-produtos"></canvas>
                    </div>
                  </div>

                  <div class="chart-card">
                    <h4>Top 5 clientes</h4>
                    <div class="chart-wrapper">
                      <canvas id="chart-top-clientes"></canvas>
                    </div>
                  </div>
                </div>

                <!-- RESUMOS (ACIMA DA TABELA) -->
                <div class="detalhes-grid">
                  <div>
                    <h4>Resumo por produto</h4>
                    <table>
                      <thead>
                        <tr>
                          <th>Produto</th>
                          <th>Qtd</th>
                          <th>Valor (R$)</th>
                          <th>%</th>
                        </tr>
                      </thead>
                      <tbody id="kpi-produtos-tbody">
                        <tr><td colspan="4">Sem dados.</td></tr>
                      </tbody>
                    </table>
                  </div>

                  <div>
                    <h4>Resumo por forma de pagamento</h4>
                    <table>
                      <thead>
                        <tr>
                          <th>Forma</th>
                          <th>Valor (R$)</th>
                          <th>%</th>
                        </tr>
                      </thead>
                      <tbody id="kpi-formas-tbody">
                        <tr><td colspan="3">Sem dados.</td></tr>
                      </tbody>
                    </table>
                  </div>

                  <div>
                    <h4>Resumo por cidade</h4>
                    <table>
                      <thead>
                        <tr>
                          <th>Cidade</th>
                          <th>Valor (R$)</th>
                          <th>%</th>
                        </tr>
                      </thead>
                      <tbody id="kpi-cidades-tbody">
                        <tr><td colspan="3">Sem dados.</td></tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <!-- TABELA DE VENDAS (mais embaixo) -->
                <div class="table-wrapper">
                  <table id="estoque-insumos-saldos-table">
                    <thead>
                      <tr>
                        <th>Data</th>
                        <th>Cliente</th>
                        <th>Produto</th>
                        <th>Quantidade</th>
                        <th>Valor unitário (R$)</th>
                        <th>Total (R$)</th>
                        <th>Lote</th>
                        <th>Nº NF</th>
                        <th>Forma</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="sales-tbody">
                      <tr><td colspan="10">Nenhuma venda carregada.</td></tr>
                    </tbody>
                  </table>
                </div>
                <p class="totais-label">Total filtrado: <span id="sales-total">R$ 0,00</span></p>
        </div>

        <div id="extrato-despesas-wrap" class="hidden">
        <h3>Despesas</h3>

                <!-- 1) Filtros de despesas (agora em cima) -->
                <section class="subsection">
                  <h3>Filtros de despesas</h3>
                  <div class="filtros-container">
                    <div class="filtros-grid">
                      <div class="form-group">
                        <label for="desp-filter-start">Data inicial</label>
                        <input type="date" id="desp-filter-start" />
                      </div>

                      <div class="form-group">
                        <label for="desp-filter-end">Data final</label>
                        <input type="date" id="desp-filter-end" />
                      </div>

                      <div class="form-group">
                        <label for="desp-filter-fornecedor">Fornecedor</label>
                        <select id="desp-filter-fornecedor">
                          <option value="">Todos os fornecedores</option>
                        </select>
                      </div>

                      <div class="form-group">
                        <label for="desp-filter-descricao">Descrição</label>
                        <input
                          type="text"
                          id="desp-filter-descricao"
                          placeholder="Buscar por descrição"
                        />
                      </div>

                      <div class="form-group">
                        <label for="desp-filter-marca">Marca</label>
                        <input
                          type="text"
                          id="desp-filter-marca"
                          placeholder="Buscar por marca"
                        />
                      </div>
                    </div>

                    <div class="filtros-botoes">
                      <button id="btn-desp-apply-filters" class="btn-secundario">
                        Aplicar filtros
                      </button>
                      <button id="btn-desp-clear-filters" class="btn-secundario">
                        Limpar filtros
                      </button>

                      <!-- NOVO -->
                      <button id="btn-desp-export-csv" class="btn-secundario">
                        Exportar Excel (CSV)
                      </button>
                    </div>
                  </div>
                </section>

                <!-- 2) Indicadores do período filtrado (agora no topo da página) -->
                <section class="subsection">
                  <h3>Indicadores do período filtrado</h3>
                  <div class="kpi-container">
                    <div class="kpi-grid">
                      <div class="kpi-card">
                        <span class="kpi-label">Total de despesas (R$)</span>
                        <span class="kpi-value" id="kpi-desp-total">R$ 0,00</span>
                      </div>
                      <div class="kpi-card">
                        <span class="kpi-label">Matéria-prima</span>
                        <span class="kpi-value" id="kpi-desp-mp">R$ 0,00</span>
                      </div>
                      <div class="kpi-card">
                        <span class="kpi-label">Embalagens</span>
                        <span class="kpi-value" id="kpi-desp-emb">R$ 0,00</span>
                      </div>
                      <div class="kpi-card">
                        <span class="kpi-label">Despesas fixas</span>
                        <span class="kpi-value" id="kpi-desp-fixas">R$ 0,00</span>
                      </div>
                      <div class="kpi-card">
                        <span class="kpi-label">Nº de lançamentos</span>
                        <span class="kpi-value" id="kpi-desp-num-lanc">0</span>
                      </div>
                      <div class="kpi-card">
                        <span class="kpi-label">Fornecedor com maior gasto</span>
                        <span class="kpi-value" id="kpi-desp-top-forn">—</span>
                      </div>
                      <div class="kpi-card">
                        <span class="kpi-label">Combustível</span>
                        <span class="kpi-value" id="kpi-desp-comb">R$ 0,00</span>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 2b) Comparação vs mesmas datas do mês anterior -->
                <section class="subsection">
                  <h3>Comparação vs mesmas datas do mês anterior</h3>
                  <div class="kpi-container">
                    <div class="kpi-grid">
                      <div class="kpi-card">
                        <span class="kpi-label">Total de despesas vs anterior</span>
                        <span class="kpi-value" id="kpi-desp-comp-total">—</span>
                      </div>
                      <div class="kpi-card">
                        <span class="kpi-label">Matéria-prima vs anterior</span>
                        <span class="kpi-value" id="kpi-desp-comp-mp">—</span>
                      </div>
                      <div class="kpi-card">
                        <span class="kpi-label">Embalagens vs anterior</span>
                        <span class="kpi-value" id="kpi-desp-comp-emb">—</span>
                      </div>
                      <div class="kpi-card">
                        <span class="kpi-label">Despesas fixas vs anterior</span>
                        <span class="kpi-value" id="kpi-desp-comp-fixas">—</span>
                      </div>
                      <div class="kpi-card">
                        <span class="kpi-label">Nº de lançamentos vs anterior</span>
                        <span class="kpi-value" id="kpi-desp-comp-num-lanc">—</span>
                      </div>
                      <div class="kpi-card">
                        <span class="kpi-label">Fornecedor com maior gasto vs anterior</span>
                        <span class="kpi-value" id="kpi-desp-comp-top-forn">—</span>
                      </div>
                      <div class="kpi-card">
                        <span class="kpi-label">Combustível vs anterior</span>
                        <span class="kpi-value" id="kpi-desp-comp-comb">—</span>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 3) Gráficos de despesas -->
                <section class="subsection">
                  <h3>Gráficos de despesas</h3>
                  <div class="charts-grid">
                    <!-- gráfico de linha mês a mês -->
                    <div class="chart-card">
                      <h4>Evolução dos gastos mês a mês</h4>
                      <div class="chart-wrapper">
                        <canvas id="chart-desp-mensal"></canvas>
                      </div>
                    </div>

                    <div class="chart-card">
                      <h4>Despesas por categoria</h4>
                      <div class="chart-wrapper">
                        <canvas id="chart-desp-categorias"></canvas>
                      </div>
                    </div>

                    <div class="chart-card">
                      <h4>Top 5 fornecedores</h4>
                      <div class="chart-wrapper">
                        <canvas id="chart-desp-fornecedores"></canvas>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 4) Resumos de despesas -->
                <section class="subsection">
                  <h3>Resumos de despesas</h3>
                  <div class="detalhes-grid">
                    <div>
                      <h4>Resumo por categoria</h4>
                      <table>
                        <thead>
                          <tr>
                            <th>Categoria</th>
                            <th>Valor (R$)</th>
                            <th>%</th>
                          </tr>
                        </thead>
                        <tbody id="kpi-desp-categorias-tbody">
                          <tr><td colspan="3">Sem dados.</td></tr>
                        </tbody>

                      </table>
                    </div>

                    <div>
                      <h4>Resumo por fornecedor (Top 10)</h4>
                      <table>
                        <thead>
                          <tr>
                            <th>Fornecedor</th>
                            <th>Valor (R$)</th>
                            <th>%</th>
                          </tr>
                        </thead>
                        <tbody id="kpi-desp-fornecedores-tbody">
                          <tr><td colspan="3">Sem dados.</td></tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </section>
<!-- 7) Lista dos itens lançados -->
                <section class="subsection">
                  <div class="table-wrapper">
                    <table>
                      <thead>
                        <tr>
                          <th>Data</th>
                          <th>Fornecedor</th>
                          <th>Descrição</th>
                          <th>Categoria</th>
                          <th>Marca</th>
                          <th>Qtd</th>
                          <th>Valor unit. (R$)</th>
                          <th>Total (R$)</th>
                          <th>Forma pagto.</th>
                          <th>Ações</th>
                        </tr>
                      </thead>
                      <tbody id="despesas-tbody">
                        <tr><td colspan="10">Nenhuma despesa lançada.</td></tr>
                      </tbody>
                    </table>
                  </div>
                  <p class="totais-label">
                    Total filtrado: <span id="despesas-total">R$ 0,00</span>
                  </p>
                </section>

        </div>

        <div id="extrato-relatorio-wrap" class="hidden">
          <h3>Relatório geral</h3>

          <div class="filtros-container">
            <div class="filtros-grid">
              <div class="form-group">
                <label for="rel-filter-start">Data inicial</label>
                <input type="date" id="rel-filter-start" />
              </div>
              <div class="form-group">
                <label for="rel-filter-end">Data final</label>
                <input type="date" id="rel-filter-end" />
              </div>
              <div class="form-group">
                <label for="rel-filter-client">Cliente</label>
                <select id="rel-filter-client">
                  <option value="">Todos os clientes</option>
                </select>
              </div>
              <div class="form-group">
                <label for="rel-filter-product">Produto</label>
                <select id="rel-filter-product">
                  <option value="">Todos os produtos</option>
                </select>
              </div>
              <div class="form-group">
                <label for="rel-filter-forma">Forma de pagamento</label>
                <select id="rel-filter-forma">
                  <option value="">Todas as formas</option>
                </select>
              </div>
              <div class="form-group">
                <label for="rel-filter-nf">Nota fiscal</label>
                <select id="rel-filter-nf">
                  <option value="">Todas</option>
                  <option value="com">Somente com NF</option>
                  <option value="sem">Somente sem NF</option>
                </select>
              </div>
              <div class="form-group">
                <label for="rel-filter-fornecedor">Fornecedor</label>
                <select id="rel-filter-fornecedor">
                  <option value="">Todos os fornecedores</option>
                </select>
              </div>
              <div class="form-group">
                <label for="rel-filter-descricao">Descrição (despesa)</label>
                <input type="text" id="rel-filter-descricao" placeholder="Buscar por descrição" />
              </div>
              <div class="form-group">
                <label for="rel-filter-marca">Marca (despesa)</label>
                <input type="text" id="rel-filter-marca" placeholder="Buscar por marca" />
              </div>
            </div>

            <div class="filtros-botoes">
              <button id="btn-rel-gerar" class="btn-secundario">Gerar relatório</button>
              <button id="btn-rel-limpar" class="btn-secundario">Limpar filtros</button>
              <button id="btn-rel-export-pdf" class="btn-secundario">Exportar PDF</button>
            </div>
          </div>

          <div class="kpi-container">
            <h4>Resumo do período</h4>
            <div class="kpi-grid">
              <div class="kpi-card">
                <span class="kpi-label">Total vendido (R$)</span>
                <span class="kpi-value" id="rel-kpi-total-vendas">R$ 0,00</span>
              </div>
              <div class="kpi-card">
                <span class="kpi-label">Total de despesas (R$)</span>
                <span class="kpi-value" id="rel-kpi-total-despesas">R$ 0,00</span>
              </div>
              <div class="kpi-card">
                <span class="kpi-label">Resultado (caixa) (R$)</span>
                <span class="kpi-value" id="rel-kpi-resultado">R$ 0,00</span>
              </div>
              <div class="kpi-card">
                <span class="kpi-label">Margem (resultado / vendas)</span>
                <span class="kpi-value" id="rel-kpi-margem">0,0%</span>
              </div>
              <div class="kpi-card">
                <span class="kpi-label">Unidades vendidas</span>
                <span class="kpi-value" id="rel-kpi-unidades">0</span>
              </div>
              <div class="kpi-card">
                <span class="kpi-label">Nº de pedidos</span>
                <span class="kpi-value" id="rel-kpi-pedidos">0</span>
              </div>
              <div class="kpi-card">
                <span class="kpi-label">Ticket médio (R$/pedido)</span>
                <span class="kpi-value" id="rel-kpi-ticket">R$ 0,00</span>
              </div>
              <div class="kpi-card">
                <span class="kpi-label">Top cliente (R$)</span>
                <span class="kpi-value" id="rel-kpi-top-cliente">—</span>
              </div>
              <div class="kpi-card">
                <span class="kpi-label">Top produto (unid.)</span>
                <span class="kpi-value" id="rel-kpi-top-produto">—</span>
              </div>
            </div>
            <p id="rel-status" class="msg"></p>
          </div>

          <div class="detalhes-grid">
            <div>
              <h4>Resumo por produto (Top 10)</h4>
              <table>
                <thead>
                  <tr>
                    <th>Produto</th>
                    <th>Qtd</th>
                    <th>Valor (R$)</th>
                    <th>%</th>
                  </tr>
                </thead>
                <tbody id="rel-produtos-tbody">
                  <tr><td colspan="4">Sem dados.</td></tr>
                </tbody>
              </table>
            </div>

            <div>
              <h4>Top 10 clientes</h4>
              <table>
                <thead>
                  <tr>
                    <th>Cliente</th>
                    <th>Valor (R$)</th>
                    <th>%</th>
                  </tr>
                </thead>
                <tbody id="rel-clientes-tbody">
                  <tr><td colspan="3">Sem dados.</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="detalhes-grid">
            <div>
              <h4>Vendas por forma de pagamento</h4>
              <table>
                <thead>
                  <tr>
                    <th>Forma</th>
                    <th>Valor (R$)</th>
                    <th>%</th>
                  </tr>
                </thead>
                <tbody id="rel-formas-tbody">
                  <tr><td colspan="3">Sem dados.</td></tr>
                </tbody>
              </table>
            </div>

            <div>
              <h4>Despesas por categoria (Top 10)</h4>
              <table>
                <thead>
                  <tr>
                    <th>Categoria</th>
                    <th>Valor (R$)</th>
                    <th>%</th>
                  </tr>
                </thead>
                <tbody id="rel-desp-categorias-tbody">
                  <tr><td colspan="3">Sem dados.</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <details open>
            <summary><strong>Extrato de vendas</strong> — <span id="rel-vendas-info">0 itens</span></summary>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Data</th>
                    <th>Cliente</th>
                    <th>Produto</th>
                    <th>Qtd</th>
                    <th>Total (R$)</th>
                    <th>Forma</th>
                    <th>Nº NF</th>
                  </tr>
                </thead>
                <tbody id="rel-vendas-tbody">
                  <tr><td colspan="7">Nenhuma venda carregada.</td></tr>
                </tbody>
              </table>
            </div>
          </details>

          <details>
            <summary><strong>Extrato de despesas</strong> — <span id="rel-despesas-info">0 itens</span></summary>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Data</th>
                    <th>Fornecedor</th>
                    <th>Descrição</th>
                    <th>Categoria</th>
                    <th>Marca</th>
                    <th>Total (R$)</th>
                    <th>Forma</th>
                  </tr>
                </thead>
                <tbody id="rel-despesas-tbody">
                  <tr><td colspan="7">Nenhuma despesa carregada.</td></tr>
                </tbody>
              </table>
            </div>
          </details>
        </div>
      </div>

<!-- Estoque -->
      <div id="section-estoque" class="section hidden">
        <h2>Estoque</h2>

        <div class="tabs subtabs">
          <button id="subtab-estoque-produtos" class="tab active-tab">Produtos acabados</button>
          <button id="subtab-estoque-insumos" class="tab">Insumos / Matérias-primas</button>
        </div>

        <div id="estoque-produtos-wrap">
          <h3>Estoque de produtos acabados</h3>

        <section class="subsection">
          <h3>Entrada / ajuste de estoque</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="est-produto">Produto</label>
              <select id="est-produto">
                <option value="">Selecione um produto</option>
              </select>
            </div>

            <div class="form-group">
              <label for="est-lote">Lote</label>
              <input
                type="text"
                id="est-lote"
                maxlength="8"
                placeholder="Ex.: 2025-001"
              />
            </div>

            <div class="form-group">
              <label for="est-validade">Data de validade</label>
              <input type="date" id="est-validade" />
            </div>

            <div class="form-group">
              <label for="est-cod-barras">Código de barras</label>
              <input
                type="text"
                id="est-cod-barras"
                placeholder="Ex.: 7891234567890"
              />
            </div>

            <div class="form-group">
              <label for="est-quantidade">Quantidade</label>
              <input
                type="number"
                id="est-quantidade"
                min="1"
                value="1"
              />
            </div>

            <div class="form-group">
              <label for="est-tipo">Tipo de movimento</label>
              <select id="est-tipo">
                <option value="ENTRADA">Entrada (+)</option>
                <option value="SAIDA">Saída (-)</option>
              </select>
            </div>

            <div class="form-group">
              <label for="est-data">Data do movimento</label>
              <input type="date" id="est-data" />
            </div>
          </div>

          <!-- BOTÕES: salvar / cancelar edição -->
          <button id="btn-save-estoque" class="btn-primario">
            Salvar movimento
          </button>
          <button id="btn-cancel-estoque" class="btn-secundario hidden">
            Cancelar edição
          </button>

          <p id="est-message" class="msg"></p>
        </section>

        <hr />

        <section class="subsection">
          <h3>Saldos atuais por produto e lote</h3>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Produto</th>
                  <th>Lote</th>
                  <th>Validade</th>
                  <th>Código de barras</th>
                  <th>Quantidade em estoque</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="estoque-saldos-tbody">
                <tr><td colspan="6">Nenhum saldo cadastrado.</td></tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- NOVO: gráfico de estoque agregado por produto -->
        <section class="subsection">
          <h3>Resumo gráfico de estoque por produto</h3>
          <div class="chart-wrapper">
            <canvas id="chart-estoque-produtos"></canvas>
          </div>
        </section>
        </div>

        <div id="estoque-insumos-wrap" class="hidden">
          <h3>Estoque de insumos</h3>

          <section class="subsection">
            <h4>Entrada / ajuste de estoque (insumos)</h4>

            <div class="form-grid">
              <div class="form-group">
                <label for="ins-item">Insumo</label>
                <select id="ins-item">
                  <option value="">Carregando itens...</option>
                </select>
              </div>

              <div class="form-group">
                <label for="ins-lote">Lote (opcional)</label>
                <input type="text" id="ins-lote" maxlength="16" placeholder="Ex.: LOTE001" />
              </div>

              <div class="form-group">
                <label for="ins-validade">Validade (opcional)</label>
                <input type="date" id="ins-validade" />
              </div>

              <div class="form-group">
                <label for="ins-cod-barras">Código de barras</label>
                <input type="text" id="ins-cod-barras" placeholder="Ex.: 7891234567890" />
              </div>

              <div class="form-group">
                <label for="ins-quantidade">Quantidade</label>
                <input type="number" id="ins-quantidade" min="0" value="1" />
              </div>

              <div class="form-group">
                <label for="ins-unidade">Unidade</label>
                <input type="text" id="ins-unidade" placeholder="kg, un, cx..." readonly />
              </div>

              <div class="form-group">
                <label for="ins-tipo">Tipo de movimento</label>
                <select id="ins-tipo">
                  <option value="ENTRADA">Entrada (+)</option>
                  <option value="SAIDA">Saída (-)</option>
                </select>
              </div>

              <div class="form-group">
                <label for="ins-custo-unit">Custo unitário (R$) — obrigatório na entrada</label>
                <input type="number" step="0.01" id="ins-custo-unit" placeholder="0,00" />
              </div>

              <div class="form-group">
                <label for="ins-data">Data do movimento</label>
                <input type="date" id="ins-data" />
              </div>
            </div>

            <button id="btn-save-estoque-insumos" class="btn-primario">Salvar movimento</button>
            <button id="btn-cancel-estoque-insumos" class="btn-secundario hidden">Cancelar edição</button>
            <p id="ins-message" class="msg"></p>
          </section>

          <hr />
          <section class="subsection">
            <h4>Saldos atuais por insumo</h4>

            <div class="filtros-container">
              <div class="filtros-grid">
                <div class="form-group">
                  <label for="ins-saldo-filter-item">Insumo</label>
                  <select id="ins-saldo-filter-item">
                    <option value="">Todos os insumos</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="ins-saldo-filter-text">Buscar</label>
                  <input
                    type="text"
                    id="ins-saldo-filter-text"
                    placeholder="Nome, lote ou código de barras"
                  />
                </div>
              </div>

              <div class="filtros-botoes">
                <button id="btn-ins-saldo-clear-filters" class="btn-secundario">
                  Limpar filtros
                </button>
              </div>
            </div>

            <div class="table-wrapper">
              <table id="estoque-insumos-saldos-table">
                <thead>
                  <tr>
                    <th>Insumo</th>
                    <th>Unidade</th>
                    <th>Lote</th>
                    <th>Validade</th>
                    <th>Última entrada</th>
                    <th>Quantidade</th>
                    <th>Custo médio (R$)</th>
                    <th>Valor em estoque (R$)</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="estoque-insumos-saldos-tbody">
                  <tr><td colspan="9">Nenhum saldo cadastrado.</td></tr>
                </tbody>
                <tfoot>
                  <tr class="row-total">
                    <td colspan="5"><strong>Totais (itens filtrados)</strong></td>
                    <td id="estoque-insumos-total-qtd"><strong>0,00</strong></td>
                    <td></td>
                    <td id="estoque-insumos-total-valor"><strong>R$ 0,00</strong></td>
                    <td></td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </section>

          <section class="subsection">
            <h4>Resumo gráfico de estoque por insumo</h4>
            <div class="chart-wrapper">
              <canvas id="chart-estoque-insumos"></canvas>
            </div>
          </section>
        </div>
      </div>

            <!-- Cadastros -->
      <div id="section-cadastros" class="section hidden">
        <div class="tabs subtabs">
          <button id="subtab-cad-clientes" class="tab active-tab">Clientes</button>
          <button id="subtab-cad-fornecedores" class="tab">Fornecedores</button>
          <button id="subtab-cad-produtos" class="tab">Produtos</button>
          <button id="subtab-cad-formas" class="tab">Formas de pagamento</button>
        </div>

<!-- Fornecedores -->
      <div id="section-fornecedores" class="section hidden">
        <h2>Fornecedores</h2>
        <p class="muted">Cadastre fornecedores, categorias e itens. As despesas são lançadas na aba <strong>Despesas</strong>.</p>

        <!-- Categorias de despesas -->
        <section class="subsection">
          <h3>Categorias de despesas</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="cat-nome">Nome da categoria</label>
              <input type="text" id="cat-nome" placeholder="Ex.: Açúcar, Frete, Gás GLP" />
            </div>

            <div class="form-group">
              <label for="cat-grupo">Grupo (KPI)</label>
              <select id="cat-grupo">
                <option value="">Selecione o grupo</option>
                <option value="Matéria-prima">Matéria-prima</option>
                <option value="Embalagens">Embalagens</option>
                <option value="Insumos de produção">Insumos de produção</option>
                <option value="Despesas fixas">Despesas fixas</option>
                <option value="Combustível">Combustível</option>
                <option value="Tributos">Tributos</option>
                <option value="Outros">Outros</option>
              </select>
            </div>

            <div class="form-group">
              <label for="cat-status">Status</label>
              <select id="cat-status">
                <option value="ativo">Ativa</option>
                <option value="inativo">Arquivada</option>
              </select>
            </div>
          </div>

          <button id="btn-save-categoria" class="btn-primario">Salvar categoria</button>
          <button id="btn-cancel-categoria" class="btn-secundario hidden">Cancelar edição</button>
          <p id="cat-message" class="msg"></p>

          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Categoria</th>
                  <th>Grupo</th>
                  <th>Status</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="categorias-tbody">
                <tr><td colspan="4">Nenhuma categoria cadastrada.</td></tr>
              </tbody>
            </table>
          </div>
        </section>

        <hr />

        <!-- 5) Cadastro de fornecedores -->
        <section class="subsection">
          <h3>Cadastro de fornecedores</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="forn-nome">Nome do fornecedor</label>
              <input
                type="text"
                id="forn-nome"
                placeholder="Ex.: Atacadão, Mercado X, Embalagens Y"
              />
            </div>
          </div>
          <button id="btn-save-fornecedor" class="btn-primario">
            Salvar fornecedor
          </button>
          <button id="btn-cancel-fornecedor" class="btn-secundario hidden">Cancelar edição</button>
          <p id="forn-message" class="msg"></p>

          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Fornecedor</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="fornecedores-tbody">
                <tr><td colspan="2">Nenhum fornecedor cadastrado.</td></tr>
              </tbody>
            </table>
          </div>
        </section>

        <hr />

        <!-- 6) Cadastro de itens por fornecedor -->
        <section class="subsection">
          <h3>Cadastro de itens por fornecedor</h3>

          <div class="form-grid">
            <div class="form-group">
              <label for="item-fornecedor">Fornecedor</label>
              <select id="item-fornecedor">
                <option value="">Selecione um fornecedor</option>
              </select>
            </div>

            <div class="form-group">
              <label for="item-descricao">Descrição do item</label>
              <input
                type="text"
                id="item-descricao"
                placeholder="Ex.: Amido de milho 25kg, Trigo 50kg..."
              />
            </div>

            <div class="form-group">
              <label for="item-categoria">Categoria</label>
              <select id="item-categoria">
                <option value="">Selecione uma categoria</option>
              </select>
            </div>

            <div class="form-group">
              <label for="item-unidade">Unidade</label>
              <input
                type="text"
                id="item-unidade"
                placeholder="Ex.: kg, un, cx, saco..."
              />
            </div>

            <div class="form-group">
              <label for="item-cod-barras">Código de barras</label>
              <input
                type="text"
                id="item-cod-barras"
                placeholder="Opcional"
              />
            </div>

            <div class="form-group">
              <label for="item-preco-padrao">Preço unitário padrão (R$)</label>
              <input
                type="number"
                step="0.01"
                id="item-preco-padrao"
                placeholder="Opcional"
              />
            </div>
          </div>

          <button id="btn-save-item-despesa" class="btn-primario">
            Salvar item
          </button>
          <button id="btn-cancel-item-despesa" class="btn-secundario hidden">Cancelar edição</button>
          <p id="item-message" class="msg"></p>

          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Fornecedor</th>
                  <th>Item</th>
                  <th>Categoria</th>
                  <th>Unidade</th>
                  <th>Cód. barras</th>
                  <th>Preço padrão (R$)</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="itens-despesas-tbody">
                <tr><td colspan="7">Nenhum item cadastrado.</td></tr>
              </tbody>
            </table>
          </div>
        </section>
      </div>

      <!-- Clientes -->
      <div id="section-clientes" class="section hidden">
        <h2>Cadastro de clientes</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="cli-nome">Nome</label>
            <input type="text" id="cli-nome" placeholder="Nome do cliente" />
          </div>
          <div class="form-group">
            <label for="cli-cidade">Cidade</label>
            <input type="text" id="cli-cidade" placeholder="Cidade do cliente" />
          </div>
        </div>
        <button id="btn-save-cliente" class="btn-primario">Salvar cliente</button>
        <button id="btn-cancel-cliente" class="btn-secundario hidden">Cancelar edição</button>
        <p id="cli-message" class="msg"></p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Nome</th>
                <th>Cidade</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="clientes-tbody">
              <tr><td colspan="3">Nenhum cliente cadastrado.</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Produtos -->
      <div id="section-produtos" class="section hidden">
        <h2>Cadastro de produtos</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="prod-desc">Descrição</label>
            <input type="text" id="prod-desc" placeholder="Ex.: Sequilho de leite condensado 200g" />
          </div>
          <div class="form-group">
            <label for="prod-peso">Peso (g)</label>
            <input type="number" id="prod-peso" placeholder="Ex.: 200" />
          </div>
          <div class="form-group">
            <label for="prod-preco">Preço unitário (R$)</label>
            <input type="number" step="0.01" id="prod-preco" placeholder="Ex.: 10,00" />
          </div>
          <!-- NOVO CAMPO: código de barras do produto -->
          <div class="form-group">
            <label for="prod-cod-barras">Código de barras</label>
            <input type="text" id="prod-cod-barras" placeholder="Ex.: 7891234567890" />
          </div>
        </div>
        <button id="btn-save-produto" class="btn-primario">Salvar produto</button>
        <button id="btn-cancel-produto" class="btn-secundario hidden">Cancelar edição</button>
        <p id="prod-message" class="msg"></p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Descrição</th>
                <th>Peso (g)</th>
                <th>Preço (R$)</th>
                <th>Código de barras</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="produtos-tbody">
              <tr><td colspan="5">Nenhum produto cadastrado.</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Formas de pagamento -->
      <div id="section-formas" class="section hidden">
        <h2>Formas de pagamento</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="fp-desc">Descrição</label>
            <input type="text" id="fp-desc" placeholder="Ex.: Dinheiro, Cartão de crédito..." />
          </div>
        </div>
        <button id="btn-save-forma" class="btn-primario">Salvar forma de pagamento</button>
        <button id="btn-cancel-forma" class="btn-secundario hidden">Cancelar edição</button>
        <p id="fp-message" class="msg"></p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Descrição</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="formas-tbody">
              <tr><td colspan="2">Nenhuma forma cadastrada.</td></tr>
            </tbody>
          </table>
        </div>
      </div>


      
      </div>

<!-- Caixa -->
      <div id="section-caixa" class="section hidden">
        <h2>Financeiro</h2>

        <h3>Caixa</h3>

        <div class="filtros-container">
          <div class="filtros-grid">
            <div class="form-group">
              <label for="caixa-filter-ano">Ano</label>
              <select id="caixa-filter-ano">
                <option value="all">Todos</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label for="caixa-data">Data</label>
            <input type="date" id="caixa-data">
          </div>

          <div class="form-group">
            <label for="caixa-valor">Saldo em conta (Banco) (R$)</label>
            <input type="number" step="0.01" id="caixa-valor" placeholder="0,00">
          </div>

          <div class="form-group">
            <label for="caixa-obs">Observação (opcional)</label>
            <input type="text" id="caixa-obs" placeholder="Ex.: saldo final do mês">
          </div>
        </div>

        <button id="btn-save-caixa" class="btn-primario">Salvar</button>
        <button id="btn-cancel-caixa" class="btn-secundario hidden">Cancelar edição</button>
        <p id="caixa-message" class="msg"></p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Data</th>
                <th>Banco (saldo)</th>
                <th>Variação do caixa</th>
                <th>Observação</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="caixa-tbody">
              <tr><td colspan="5">Nenhum lançamento ainda.</td></tr>
            </tbody>
          </table>
        </div>

        <div class="charts-grid">
          <div class="chart-card">
            <h4>Variação do caixa</h4>
            <div class="chart-wrapper">
              <canvas id="chart-caixa-variacao"></canvas>
            </div>
          </div>

          <div class="chart-card">
            <h4>Capital operacional (Banco + Estoque)</h4>
            <div class="chart-wrapper">
              <canvas id="chart-caixa-saldo"></canvas>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <h3>Resultado do mês</h3>

        <div class="form-grid">
          <div class="form-group">
            <label for="resultado-mesref">Mês de referência</label>
            <input type="month" id="resultado-mesref">
          </div>

          <div class="form-group">
            <label for="resultado-estoque-inicial">Estoque inicial (R$) — só se for o 1º mês</label>
            <input type="number" step="0.01" id="resultado-estoque-inicial" placeholder="0,00">
          </div>
        </div>

        <button id="btn-fechar-resultado" class="btn-primario">Fechar resultado do mês</button>
        <p id="resultado-message" class="msg"></p>

        <div class="kpi-container">
          <div class="kpi-grid">
            <div class="kpi-card">
              <span class="kpi-label">Vendas do mês (R$)</span>
              <span class="kpi-value" id="res-vendas">R$ 0,00</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-label">CMV do mês (R$)</span>
              <span class="kpi-value" id="res-cmv">R$ 0,00</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-label">Despesas do mês (R$)</span>
              <span class="kpi-value" id="res-despesas">R$ 0,00</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-label">Retiradas do mês (R$)</span>
              <span class="kpi-value" id="res-retiradas">R$ 0,00</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-label">Lucro/Prejuízo do mês (R$)</span>
              <span class="kpi-value" id="res-lucro">R$ 0,00</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-label">Margem líquida (%)</span>
              <span class="kpi-value" id="res-margem">0,0%</span>
            </div>
          </div>
          <div class="resultado-info-grid">
            <div class="resultado-info-card">
              <div class="resultado-info-title">Formulas</div>
              <p class="muted" id="res-detalhe-cmv">CMV = Estoque inicial + Compras do mês – Estoque final</p>
              <p class="muted" id="res-detalhe-lucro-formula">Lucro/Prejuízo = Vendas do mês – CMV do mês – Despesas do mês – Retiradas do mês</p>
              <p class="muted" id="res-detalhe-margem-formula">Margem líquida (%) = (Lucro/Prejuízo ÷ Vendas do mês) × 100 (se Vendas &gt; 0)</p>
            </div>

            <div class="resultado-info-card">
              <div class="resultado-info-title">Componentes do CMV</div>
              <div id="res-detalhes-extra"></div>
            </div>
          </div>
        </div>

        <h4>Resultados fechados</h4>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Mês</th>
                <th>Vendas</th>
                <th>CMV</th>
                <th>Despesas</th>
                <th>Retiradas</th>
                <th>Lucro</th>
                <th>Margem líquida</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="resultado-tbody">
              <tr><td colspan="8">Nenhum resultado fechado ainda.</td></tr>
            </tbody>
          </table>
        </div>

      </div>

    </div>
  </main>

  <!-- Script do "Esqueceu a senha?" (sem mexer no auth.js) -->
  <script>
    (function () {
      const btnForgot = document.getElementById('btn-forgot-password');
      const emailInput = document.getElementById('login-email');
      const loadingEl = document.getElementById('loading');
      const errorEl = document.getElementById('login-error');
      const msgEl = document.getElementById('forgot-message');

      if (!btnForgot) return;

      function setLoading(isLoading) {
        if (!loadingEl) return;
        loadingEl.classList.toggle('hidden', !isLoading);
      }

      function clearMessages() {
        if (errorEl) errorEl.textContent = '';
        if (msgEl) {
          msgEl.textContent = '';
          msgEl.classList.remove('ok', 'error');
        }
      }

      btnForgot.addEventListener('click', async () => {
        clearMessages();

        const email = (emailInput?.value || '').trim();
        if (!email) {
          if (errorEl) errorEl.textContent = 'Digite seu e-mail acima para receber o link de redefinição.';
          return;
        }

        try {
          setLoading(true);
          await firebase.auth().sendPasswordResetEmail(email);

          if (msgEl) {
            msgEl.textContent = 'Se existir uma conta com esse e-mail, enviamos um link para redefinir sua senha.';
            msgEl.classList.add('ok');
          }
        } catch (err) {
          if (errorEl) {
            errorEl.textContent = (err && err.message)
              ? err.message
              : 'Não foi possível enviar o link de redefinição. Tente novamente.';
          }
        } finally {
          setLoading(false);
        }
      });
    })();
  </script>
</body>
</html>

